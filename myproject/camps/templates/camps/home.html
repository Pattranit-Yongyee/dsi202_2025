{% extends 'camps/base.html' %}

{% block content %}
  <div class="mt-16">
    <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å -->
  <h2 class="text-3xl md:text-5xl font-extrabold text-center bg-gradient-to-r from-indigo-600 via-purple-500 to-pink-500 text-transparent bg-clip-text tracking-tight mb-12 animate-fade-in relative z-10">
    Welcome to Peddle Camp<br>
    <span class="text-xl md:text-2xl font-medium block mt-2 subtitle bg-gradient-to-r from-indigo-600 via-purple-500 to-pink-500 text-transparent bg-clip-text">" The Space where you discover YOURSELF "</span>
  </h2>

  <h2 class="text-2xl font-bold text-center mb-8 text-red-600">
    üî• <span class="bg-gradient-to-r from-red-500 via-orange-400 to-pink-500 text-transparent bg-clip-text">
      ‡∏Ñ‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£! ‡∏£‡∏µ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏•‡∏¢!
    </span>
  </h2>

  <!-- Carousel Section -->
  <div class="relative overflow-hidden mb-12 max-w-4xl mx-auto"> 
    <div id="carousel" class="flex transition-transform duration-500 ease-in-out">
      {% for camp in close_soon_camps|slice:":5" %}
        <div class="w-full flex-shrink-0 px-4"> 
          <a href="{% url 'camp_detail' camp.id %}" class="block bg-white border border-red-400 rounded-xl shadow-md hover:shadow-xl hover:scale-[1] transition-all duration-300 p-8 relative"> 

            <div class="absolute top-0 right-0 bg-red-500 text-white text-sm font-bold px-3 py-1 rounded-bl-lg shadow"> 
              ‡∏≠‡∏µ‡∏Å {{ camp.days_left }} ‡∏ß‡∏±‡∏ô
            </div>

            {% if camp.image %}
              <img src="{{ camp.image.url }}" alt="{{ camp.title }}" class="w-full h-48 object-cover rounded-lg mb-4"> 
            {% else %}
              <img src="https://via.placeholder.com/400x192?text=No+Image" alt="No image" class="w-full h-48 object-cover rounded-lg mb-4"> 
            {% endif %}

            <h3 class="font-semibold text-indigo-900 text-lg mb-2">{{ camp.title }}</h3>
            <p class="text-base text-gray-600 mb-2">{{ camp.description|truncatewords:15 }}</p> 
            <p class="text-base text-gray-700"><strong>‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö:</strong> {{ camp.application_deadline }}</p> 
          </a>
        </div>
      {% endfor %}

      <!-- Clone ‡∏™‡πÑ‡∏•‡∏î‡πå‡πÅ‡∏£‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏õ‡∏•‡∏∑‡πà‡∏ô -->
      {% with camp=close_soon_camps.0 %}
        {% if camp %}
          <div class="w-full flex-shrink-0 px-4"> <!-- ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡πÑ‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô -->
            <a href="{% url 'camp_detail' camp.id %}" class="block bg-white border border-red-400 rounded-xl shadow-md hover:shadow-xl hover:scale-[1.02] transition-all duration-300 p-8 relative">
              <div class="absolute top-0 right-0 bg-red-500 text-white text-sm font-bold px-3 py-1 rounded-bl-lg shadow">
                ‡∏≠‡∏µ‡∏Å {{ camp.days_left }} ‡∏ß‡∏±‡∏ô
              </div>
              {% if camp.image %}
                <img src="{{ camp.image.url }}" alt="{{ camp.title }}" class="w-full h-48 object-cover rounded-lg mb-4"> <!-- ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á -->
              {% else %}
                <img src="https://via.placeholder.com/400x192?text=No+Image" alt="No image" class="w-full h-48 object-cover rounded-lg mb-4">
              {% endif %}
              <h3 class="font-semibold text-indigo-900 text-lg mb-2">{{ camp.title }}</h3>
              <p class="text-base text-gray-600 mb-2">{{ camp.description|truncatewords:15 }}</p>
              <p class="text-base text-gray-700"><strong>‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö:</strong> {{ camp.application_deadline }}</p>
            </a>
          </div>
        {% endif %}
      {% endwith %}
    </div>
  </div>

  <!-- Divider Section -->
  <div class="my-16 relative flex items-center justify-center">
    <div class="absolute w-full border-t border-gray-300"></div>
    <span class="bg-white px-4 text-gray-500 text-sm z-10"></span>
  </div>

  <!-- Category Sections -->
  {% for category_slug, category_info in camps_by_category.items %}
    <div class="mb-10 border border-gray-200 rounded-xl shadow p-5 bg-white animate-fade-in">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold text-red-500">
          {{ category_info.display_name }}
        </h2>
        <a href="{% url 'category_camps' category_slug %}" class="text-sm text-indigo-600 hover:underline">
          ‡∏î‡∏π‡∏Ñ‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
        {% for camp in category_info.camps %}
          <a href="{% url 'camp_detail' camp.id %}" class="block border border-gray-100 bg-gray-50 hover:bg-white rounded-lg p-4 shadow hover:scale-[1.02] hover:shadow-md transition-all duration-300">
            {% if camp.image %}
              <img src="{{ camp.image.url }}" alt="{{ camp.title }}" class="w-full h-36 object-cover rounded mb-3">
            {% else %}
              <img src="https://via.placeholder.com/200" alt="Placeholder" class="w-full h-36 object-cover rounded mb-3">
            {% endif %}
            <h3 class="text-base font-semibold text-indigo-800 mb-1">{{ camp.title }}</h3>
            <p class="text-gray-600 mb-1 text-sm">{{ camp.description|truncatewords:15 }}</p>
            <p class="text-gray-700 text-sm">üë• ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°: {{ camp.participants }}</p>
            <p class="text-gray-700 text-sm">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: {{ camp.location }}</p>
            <p class="text-gray-700 text-sm">üí∞ ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: {{ camp.fee }}</p>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endfor %}

  <style>
    @keyframes pulse-slow {
    0%, 100% {
      transform: scale(1);
      opacity: 0.8;
    }
    50% {
      transform: scale(1.02);
      opacity: 1;
    }
  }

  .animate-pulse-slow {
    animation: pulse-slow 3s ease-in-out infinite;
  }

  @keyframes fade-in {
    0% {
      opacity: 0;
      transform: translateY(15px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.6s ease-out;
  }
</style>
  </style>

  <script>
    let currentIndex = 0;
    let carousel, slides, totalSlides, slideCount;

    window.addEventListener('load', () => {
      carousel = document.getElementById('carousel');
      slides = carousel.children;
      slideCount = 5; // ‡πÄ‡∏£‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà 5 ‡∏Ñ‡πà‡∏≤‡∏¢
      totalSlides = slideCount + 1; // +1 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ clone ‡∏™‡πÑ‡∏•‡∏î‡πå‡πÅ‡∏£‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡πâ‡∏≤‡∏¢

      updateSlide();

      // Auto slide
      setInterval(() => {
        nextSlide();
      }, 4000);
    });

    function updateSlide(animate = true) {
      if (!animate) {
        carousel.style.transition = 'none';
      } else {
        carousel.style.transition = 'transform 0.5s ease-in-out';
      }
      const offset = -currentIndex * 100;
      carousel.style.transform = `translateX(${offset}%)`;
    }

    function nextSlide() {
      currentIndex++;
      updateSlide();

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡∏™‡πÑ‡∏•‡∏î‡πå clone ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ index 0 ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å
      if (currentIndex === totalSlides) {
        setTimeout(() => {
          currentIndex = 0;
          updateSlide(false);
        }, 500);
      }
    }

    function prevSlide() {
      if (currentIndex === 0) {
        currentIndex = slideCount;
        updateSlide(false);
        setTimeout(() => {
          currentIndex--;
          updateSlide();
        }, 20);
      } else {
        currentIndex--;
        updateSlide();
      }
    }
  </script>
{% endblock %}
